<!DOCTYPE html>
<html>
<head>
    <title>ChatGPT Clone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
// === Safe backend call ===
async function callServer(message){
    const res = await fetch("https://pirate-xa18.onrender.com/chat", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message})
    });
    const data=await res.json();
    return data.reply;
}

        // JavaScript will go here
        // ==== OpenAI API Key & Function ====
/* API removed for backend safety */
// ================= Voice Input Section ==================

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (SpeechRecognition) {
    const recognition = new SpeechRecognition();
    recognition.lang = "en-IN"; // Change to "hi-IN" for Hindi recognition

    document.getElementById("micBtn").onclick = () => {
        recognition.start();
        console.log("ðŸŽ¤ Listening...");
    };

    recognition.onresult = (event) => {
        let text = event.results[0][0].transcript;
        document.getElementById("messageInput").value = text;  // Writes spoken text in box
    };

} else {
    alert("Voice not supported in your browser");
}
    </script>
    <style>
        /* ALL STYLES ARE HERE - NO EXTERNAL FILES */
        #sendButton {
    background: linear-gradient(135deg, #19c37d, #17b171);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(25, 195, 125, 0.3);
}
// Voice Reply (Text-to-Speech)
function speakText(text) {
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 1;      // Speed of speech
        utterance.pitch = 1;     // Voice pitch
        window.speechSynthesis.speak(utterance);
    }
}

#micButton {
    background: #202123;
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: pointer;
    transition: 0.3s;
}
#micButton:hover {
    transform: scale(1.05);
}
#micButton:active {
    transform: scale(0.95);
}

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .app-container {
            width: 100%;
            max-width: 500px;
            height: 95vh;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #202123;
            color: white;
            padding: 18px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header span {
            background: #10a37f;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .chat-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f7f7f8;
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            flex-direction: row-reverse;
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            flex-shrink: 0;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }
        
        .user-avatar {
            background: linear-gradient(135deg, #19c37d, #17b171);
        }
        
        .ai-avatar {
            background: linear-gradient(135deg, #10a37f, #0d8c6c);
        }
        
        .text-bubble {
            max-width: 75%;
            padding: 14px 18px;
            border-radius: 20px;
            line-height: 1.5;
            font-size: 15px;
            word-wrap: break-word;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .user-bubble {
            background: linear-gradient(135deg, #19c37d, #17b171);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .ai-bubble {
            background: white;
            color: #333;
            border: 1px solid #e5e5e5;
            border-bottom-left-radius: 5px;
        }
        
        .input-container {
            padding: 18px;
            background: white;
            border-top: 1px solid #e5e5e5;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        #messageInput {
            flex: 1;
            padding: 16px 18px;
            border: 2px solid #e5e5e5;
            border-radius: 16px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        #messageInput:focus {
            border-color: #19c37d;
            box-shadow: 0 0 0 3px rgba(25, 195, 125, 0.2);
        }
        
        #sendButton {
            background: linear-gradient(135deg, #19c37d, #17b171);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(25, 195, 125, 0.3);
        }
        
        #sendButton:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(25, 195, 125, 0.4);
        }
        
        #sendButton:active {
            transform: scale(0.98);
        }
        
        .typing-indicator {
            display: flex;
            gap: 6px;
            padding: 15px;
            align-items: center;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #ccc;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.5; }
            40% { transform: translateY(-8px); opacity: 1; }
        }
        
        /* Scrollbar styling */
        .chat-area::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-area::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-area::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        /* Mobile responsive */
        @media (max-width: 480px) {
            .app-container {
                height: 100vh;
                border-radius: 0;
                max-width: 100%;
            }
            
            .text-bubble {
                max-width: 85%;
                font-size: 14px;
                padding: 12px 16px;
            }
            
            .avatar {
                width: 32px;
                height: 32px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <span>ðŸ¤–</span>
            ChatGPT Clone
        </div>
        
        <!-- Chat Messages Area -->
        <div class="chat-area" id="chatArea">
            <!-- Messages will appear here -->
        </div>
        
        <!-- Input Area -->
        <div class="input-container">
            <input 
                type="text" 
                id="messageInput" 
                placeholder="Message ChatGPT..." 
                autocomplete="off"
            >
            <button id="sendButton">âž¤</button>
            <button id="micButton">ðŸŽ¤</button>

        </div>
    </div>
    <script>
      // Text-to-Speech Function
function speak(text) {
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 1; // Speed (0.5 slow, 1 normal, 1.5 fast)
        utterance.pitch = 1; // Voice pitch
        window.speechSynthesis.speak(utterance);
    }
}
        // DOM Elements
        const chatArea = document.getElementById('chatArea');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        
        // Voice Input Feature
const micButton = document.getElementById("micButton");
let recognition;
let isListening = false;

if ("webkitSpeechRecognition" in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = "en-US";

    recognition.onresult = function(event) {
        const voiceText = event.results[0][0].transcript;
        messageInput.value = voiceText;
        sendMessage();
    };

    recognition.onerror = function() {
        isListening = false;
        micButton.innerHTML = "ðŸŽ¤";
    };

    recognition.onend = function() {
        isListening = false;
        micButton.innerHTML = "ðŸŽ¤";
    };
}

micButton.addEventListener("click", () => {
    if (!isListening) {
        isListening = true;
        micButton.innerHTML = "ðŸŽ™ï¸";
        recognition.start();
    } else {
        recognition.stop();
        micButton.innerHTML = "ðŸŽ¤";
        isListening = false;
    }
});
        // Chat state
        let isProcessing = false;
        let chatHistory = [];
        
        // Initialize
        window.onload = function() {
            // Load any saved chat history
            loadChatHistory();
            
            // Focus input field
            messageInput.focus();
            
            // Add welcome message after delay
            setTimeout(() => {
                if (chatHistory.length === 0) {
                    addMessage('ai', "Hello! I'm ChatGPT, an AI assistant. How can I help you today?");
                }
            }, 800);
        };
        
        // Load chat history from localStorage
        function loadChatHistory() {
            try {
                const saved = localStorage.getItem('chatHistory');
                if (saved) {
                    chatHistory = JSON.parse(saved);
                    chatHistory.forEach(msg => {
                        displayMessage(msg.role, msg.content, false);
                    });
                }
            } catch (e) {
                console.log("Could not load chat history");
            }
        }
        
        // Save chat to localStorage
        function saveChatHistory() {
            try {
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
            } catch (e) {
                console.log("Could not save chat history");
            }
        }
        
        // Display a message in the chat
        function displayMessage(role, content, sender, Message, saveToHistory = true) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;
            
            const avatar = document.createElement('div');
            avatar.className = `avatar ${role}-avatar`;
            avatar.textContent = role === 'user' ? 'U' : 'AI';
            
            const bubble = document.createElement('div');
            bubble.className = `text-bubble ${role}-bubble`;
            bubble.textContent = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            chatArea.appendChild(messageDiv);
            
            // Save to history if needed
            if (saveToHistory) {
                chatHistory.push({ role, content });
                saveChatHistory();
            }
            
            // Scroll to bottom
            chatArea.scrollTop = chatArea.scrollHeight;
            
            return bubble;
                // -------- Voice Reply (only when bot speaks) ----------
    if (sender === "bot") {
        let speech = new SpeechSynthesisUtterance(message);
        speech.rate = 1;   // speed 1 normal
        speech.pitch = 1;  // natural tone
        speechSynthesis.speak(speech);
    }
        }
        
        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message';
            typingDiv.id = 'typingIndicator';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar ai-avatar';
            avatar.textContent = 'AI';
            
            const dots = document.createElement('div');
            dots.className = 'text-bubble ai-bubble typing-indicator';
            dots.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            
            typingDiv.appendChild(avatar);
            typingDiv.appendChild(dots);
            chatArea.appendChild(typingDiv);
            
            // Scroll to bottom
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        // Remove typing indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }
        // ---------------- AI RESPONSE SYSTEM ----------------
//  ==== Dataset + OpenAI Response ====
async function getAIResponse(userMessage) {
    const lowerMsg = userMessage.toLowerCase();

    // ======== Your College Dataset (Q&A Direct Replies) =========
    if (lowerMsg.includes("admission")) return "Admissions are based on Counseling.";
    if (lowerMsg.includes("courses")) return "We offer CSE, ECE, EEE, Mechanical, Civil and Robotics.";
    if (lowerMsg.includes("timing") || lowerMsg.includes("time")) return "College timing is 9 AM to 5 PM, Monday to Friday.";
    if (lowerMsg.includes("hostel")) return "Hostel available for boys and girls with mess.";
    if (lowerMsg.includes("contact")) return "Email: info@tpgit.edu.in, Phone: 0416-2267762.";
    if (lowerMsg.includes("fees") || lowerMsg.includes("fee")) return "Fees depend on the course & semester. Contact office for details.";
    if (lowerMsg.includes("exam")) return "Semester exams follow Anna University schedule.";
    if (lowerMsg.includes("result")) return "Results are published on Anna University website.";
    if (lowerMsg.includes("library")) return "Library open 9 AM - 5 PM (borrow up to 5 books).";
    if (lowerMsg.includes("bus")) return "Bus facilities are not available.";
    if (lowerMsg.includes("sports")) return "We have cricket, football, basketball & indoor games.";
    if (lowerMsg.includes("club")) return "Clubs: Coding, Robotics, Arts, Music.";
    if (lowerMsg.includes("scholarship")) return "Community & Pragati scholarships available.";
    if (lowerMsg.includes("principal")) return "Principal: Letitia.";
    if (lowerMsg.includes("events")) return "Annual cultural & technical events in December.";
    if (lowerMsg.includes("placement")) return "Good placement record, top companies visit.";
    if (lowerMsg.includes("address") || lowerMsg.includes("location")) return "Thanthai Periyar Government Institute of Technology, Vellore.";

    // ====== If not found in dataset â†’ ask OpenAI API ======
    return await callServer(userMessage);
}
        // Send message function
        async function sendMessage() {
    const message = messageInput.value.trim();
    if (!message || isProcessing) return;

    isProcessing = true;
    displayMessage('user', message);
    messageInput.value = '';

    showTypingIndicator();

    try {
        const aiResponse = await getAIResponse(message);  // ðŸ”— Connect dataset + API
        removeTypingIndicator();
        displayMessage('ai', aiResponse);
        speak(aiResponse);
    }
    catch {
        displayMessage('ai', "âš  Something went wrong.");
        removeTypingIndicator();
    }

    isProcessing = false;
}
        
        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // Auto-resize input (for multi-line if enabled later)
        messageInput.addEventListener('input', function() {
            if (this.value.includes('\n')) {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            }
        });
        
        // Clear chat function (optional)
        window.clearChat = function() {
    if (confirm("Clear all chat history?")) {
        chatArea.innerHTML = '';
        chatHistory = [];
        localStorage.removeItem('chatHistory');
        setTimeout(() => {
            addMessage('ai', "Chat cleared! How can I help you now?");
        }, 500);
    }
};

// Text-to-speech for AI reply
async function speakAIResponse(text) {
    speak(text);
}

// Modify inside sendMessage()

// After you add AI message:
displayMessage('ai', aiResponse);
speakAIResponse(aiResponse);

</script>
</body>
</html>
